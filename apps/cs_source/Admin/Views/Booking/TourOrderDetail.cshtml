@using System
@using Vinaday.Data.Models
@using Vinaday.Data.Models.Extention
@using Vinaday.Web.Framework
@{
    ViewBag.Title = "TourOrderDetail";
    Layout = "~/Views/Shared/_TourLayout.cshtml";
    //OrderModel order = ViewBag.Order;
}
<style>
    div.radios {
        height: 17px;
        margin-left: -6px;
        margin-top: -3px;
        width: 17px;
    }

    label, .label-field {
        font-size: 11px;
    }

    #booking-info tbody tr td {
        padding: 0 8px;
    }

        #booking-info tbody tr td p {
            margin: 0;
        }
</style>
<div id="main-content" class="main-content container-fluid">
    @if (order != null)
    {
        <div id="page-content" class="page-content tab-content overflow-y">
            <div class="row-fluid">

                <div class="span8 grider">
                    @if (order.Tour != null)
                    {
                        <input type="hidden" id="order-id" value="@order.Id" />
                        <div class="widget widget-simple">
                            <div class="widget-header">
                                <h4><i class="fontello-icon-user"></i> Booking's Information - @string.Format("#{0}", order.Pnr)</h4>
                            </div>
                            <div class="widget-content">
                                <div class="widget-body">
                                    <ul class="widget-list thumb-xxlarge media-overflow">
                                        <li class="media">
                                            <div class="media-thumb media-left">
                                                <a class="img-shadow" href="javascript:void(0);">
                                                    <img class="media-object thumb" src="@Url.Content(order.Avatar ?? "/Content/img/no-image.jpg")">
                                                </a>
                                            </div>
                                            <div class="media-body">
                                                <h4 class="media-heading">
                                                    <a href="@Url.Content(string.Format("~/Tour/BasicInformation/{0}",order.ProductId))">@string.Format("{0} - {1}", order.Tour.TourCode, order.Tour.Name)</a>
                                                    <span class="label @(order.Status == (int)Utilities.BookingStatus.Holding ? "label-important" : "label-success") pull-right">@(Enum.GetName(typeof(Utilities.BookingStatus), order.Status))</span>
                                                </h4>
                                                <div class="quick-menu menu-right">
                                                    @if (order.Status == (int)Utilities.BookingStatus.Paid)
                                                    {
                                                        <div class="btn-group">
                                                            <button data-toggle="dropdown" class="btn btn-mini dropdown-toggle">
                                                                <i class="fontello-icon-cog-4"></i> &nbsp;<span class="caret"></span>
                                                            </button>
                                                            <ul class="dropdown-menu pull-right">
                                                                <li><a onclick="amend();"><i class="icon-pencil"></i><span></span> Amend</a></li>
                                                                <li><a onclick="refund();"><i class="icon-remove"></i><span></span> Refund</a></li>
                                                                <li><a onclick="cancel();"><i class="icon-ok"></i><span></span> Cancel</a></li>
                                                                <li class="divider"></li>
                                                                <li><a href="#"><i class="icon-trash"></i><span></span> Delete</a></li>
                                                            </ul>
                                                        </div>
                                                    }
                                                    else if (order.Status == (int)Utilities.BookingStatus.Holding)
                                                    {
                                                        <button class="btn btn-mini" onclick="approved();">Payment</button>
                                                    }

                                                </div>
                                                <div class="data span8">
                                                    <table class="table bg-blue-light" id="booking-info">

                                                        <tbody class="media-thumb">


                                                            <tr>
                                                                <td>@Html.Raw(string.Format("Check-in: <p><strong>{0}</strong></p>", order.StartDate))</td>
                                                                @switch (order.PaymentMethod)
                                                                {
                                                                    case (int)Utilities.PaymentMethod.Cash:
                                                                        <td>
                                                                            Method:<p><strong><span style="font-size: 4px !important;" class="fontello-icon-dollar"></span>Cash</strong></p>
                                                                        </td>
                                                                        break;
                                                                    case (int)Utilities.PaymentMethod.Credit:
                                                                    <td>
                                                                        Method:<p><strong><span style="font-size: 4px !important;" class="fontello-icon-credit-card-2"></span>Credit</strong></p>

                                                                    </td>
                                                                        break;
                                                                    case (int)Utilities.PaymentMethod.Transfer:
                                                                    <td>
                                                                        Method:<p><strong><span style="font-size: 4px !important;" class="fontello-icon-ticket"></span>Transfer</strong></p>
                                                                    </td>
                                                                        break;
                                                                    default:
                                                                    <td></td>
                                                                        break;
                                                                }
                                                                @if (order.PaymentMethod > 1)
                                                                {
                                                                    <td style="max-width: 75px;">@Html.Raw(string.Format("Card ID: <p><strong>{0}</strong></p>", order.CardNumber))</td>
                                                                }
                                                                else if (order.PaymentMethod == 1)
                                                                {
                                                                    <td style="max-width: 75px;">@Html.Raw(string.Format("Paid: <p><strong>{0}<sup>USD</sup></strong></p>", order.Amount))</td>
                                                                }
                                                                else
                                                                {
                                                                    <td></td>
                                                                }

                                                            </tr>
                                                            <tr>
                                                                <td>@Html.Raw(string.Format("Price: <p><strong>{0}<sup>USD</sup></strong></p>", order.Price))</td>
                                                                <td>@Html.Raw(string.Format("Quantity: <p><strong>{0} {1}</strong></p>", order.Quantity, order.Quantity > 1 ? "Persons" : "Person"))</td>
                                                                <td style="max-width: 75px;">@Html.Raw(string.Format("Amount: <p><strong>{0}<sup>USD</sup></strong></p>", order.Amount))</td>
                                                            </tr>

                                                        </tbody>
                                                    </table>

                                                </div>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    }
                </div>
                <div class="span4 grider">
                    @if (order.Customer != null)
                    {
                        <div class="widget widget-simple widget-notes">
                            <div class="widget-header">
                                <h4><i class="fontello-icon-user"></i> Customer's infomartion</h4>
                            </div>
                            <div class="widget-content">
                                <div class="widget-body">
                                    <ul class="widget-list thumb-xxlarge media-overflow">
                                        <li class="media">
                                            <div class="media-thumb media-left">
                                                <a class="img-shadow" href="javascript:void(0);">
                                                    <img class="media-object thumb" src="/Content/img/NoProfile.jpg" alt="">
                                                </a>
                                            </div>
                                            <div class="media-body">
                                                <h4 class="media-heading">
                                                    <a href="javascript:void(0);">@(string.Format("{0} {1}", order.Customer.Firstname, order.Customer.Lastname))</a>
                                                </h4>

                                                <ul class="data">

                                                    @*<li>
                                                            <div class="em margin-bottom5">manager to manager</div>
                                                        </li>
                                                        <li>San Francisco, CA 94107</li>*@
                                                    <li><abbr title="Phone"><i class="fontello-icon-phone opaci75"></i> : </abbr> <strong>@Utilities.FormatPhone(order.Customer.PhoneNumber)</strong></li>
                                                    <li><abbr title="Email"><i class="fontello-icon-mail-4 opaci75"></i> : </abbr> <a href="javascript:void(0);">@order.Customer.Email</a></li>
                                                    <li><abbr title="Nationality"><i class="fontello-icon-dribbble opaci75"></i> : </abbr> <a href="javascript:void(0);">@order.Customer.Nationality.Name</a></li>

                                                </ul>
                                            </div>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    }
                </div>
            </div>
            <div class="row-fluid">
                <div class="span12 grider">
                    <div class="widget widget-box widget-table widget-list">
                        <div class="widget-header">
                            <h4><i class="fitem-icon fontello-icon-align-justify"></i> History</h4>
                        </div>
                        <table id="lastLogedTable" class="table table-striped table-hover thumb-small bg-blue-light">
                            <thead>
                                <tr class="condensed">
                                    <th scope="col">ID <span class="column-sorter"></span></th>
                                    <th scope="col">Note <span class="column-sorter"></span></th>
                                    <th scope="col">Changed <span class="column-sorter"></span></th>
                                    <th scope="col">Value <span class="column-sorter"></span></th>
                                    <th scope="col">Roles <span class="column-sorter"></span></th>
                                    <th scope="col">Updated <span class="column-sorter"></span></th>
                                    <th scope="col" style="text-align: center">Action</th>
                                </tr>
                            </thead>
                            <tbody class="media-thumb">

                                @if (order.OrderDetails != null && order.OrderDetails.Count > 0)
                                {
                                    foreach (var detail in order.OrderDetails)
                                    {
                                        <tr>
                                            <td>
                                                @detail.Id
                                            </td>
                                            <td>@Html.Raw(detail.Note)</td>
                                            <td>@Html.Raw(detail.ChangedName)</td>
                                            <td>@Html.Raw(detail.ChangedValue)</td>
                                            <td>Administrator</td>
                                            <td>
                                                <strong>@detail.CreatedDate</strong>

                                            </td>
                                            <td style="text-align: center">
                                                @if (!detail.IsSend)
                                                {
                                                    <a class=" fontello-icon-mail-alt" style="cursor: pointer" onclick="sendEmail('@detail.Id');"></a>
                                                }
                                                else
                                                {
                                                    <span class=" fontello-icon-mail-alt"></span>
                                                }

                                            </td>
                                        </tr>
                                    }
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }

</div>
<div id="change-status-modal" class="modal hide fade" tabindex="-1" data-width="40%">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fontello-icon-cancel-1"></i></button>
        <h3><i class="fontello-icon-article-alt opaci35"></i> <span id="title"></span> <small id="contact-type-title">booking</small></h3>
    </div>
    <div class="modal-body">
        <div class="well well-nice">
            <section>
                <div class="row-fluid">
                    <fieldset>
                        <ul class="form-list label-left list-bordered dotted">
                            <li id="value-group">
                                <label for="change-value" id="label-change-value">Value <span class="required">*</span></label>
                                <input id="change-value" class="maskDate span12" type="text" name="change-value">
                            </li>
                            <li id="note-group">
                                <label for="note">
                                    Note :
                                    <span class="required">*</span>
                                </label>

                                <textarea class="span12" id="note" rows="10"></textarea>

                            </li>
                        </ul>
                    </fieldset>
                </div>
            </section>
        </div>
    </div>
    <div class="modal-footer">
        <div id="modal-footer"></div>
    </div>
</div>
<div id="approved-modal" class="modal hide fade" tabindex="-1" data-width="40%">
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true"><i class="fontello-icon-cancel-1"></i></button>
        <h3><i class="fontello-icon-article-alt opaci35"></i> <span>Payment </span><small>method</small></h3>
    </div>
    <div class="modal-body">
        <div class="well well-nice">
            <section>
                <div class="row-fluid">
                    <fieldset>
                        <div id="payment-method">
                            <div class="tabbable tabbable-bordered tabs-left">
                                <ul>
                                    <li><a href="#cash" data-toggle="tab"><input type="hidden" value="1" /><span class="fontello-icon-dollar"></span> Cash</a></li>
                                    <li><a href="#credit" data-toggle="tab"><input type="hidden" value="2" /><span class="fontello-icon-credit-card-2"></span> Credit</a></li>
                                    <li><a href="#transfer" data-toggle="tab"><input type="hidden" value="3" /><span class="fontello-icon-ticket"></span> Transfer</a></li>
                                </ul>
                                <div class="tab-content" style="min-height:150px">
                                    <div class="tab-pane" id="cash" style="text-align: center;">
                                        <div class="control-group">
                                            <h3>
                                                <i class="fontello-icon-dollar"></i><span>Cash </span>
                                                <small>method selected!.</small>
                                            </h3>
                                            <label class="control-label">Please select "Apply" bottom to approve this booking. </label>
                                        </div>
                                    </div>

                                    <div class="tab-pane" id="credit" style="text-align: center;">
                                        <h3>
                                            <i class="fontello-icon-credit-card-2"></i><span>Credit </span>
                                            <small>method selected!.</small>
                                        </h3>
                                        <label class="control-label">Please input credit number and select "Apply" bottom.</label>
                                        <input style="text-align: center;font-weight: bold;" id="credit-method" class="creditCard span8" type="text" placeholder="****-****-****-****">
                                    </div>

                                    <div class="tab-pane" id="transfer" style="text-align: center;">
                                        <h3>
                                            <i class="fontello-icon-ticket"></i><span>Transfer </span>
                                            <small>method selected!.</small>
                                        </h3>
                                        <label class="control-label">Please input transfer number and select "Apply" bottom.</label>
                                        <input id="transfer-method" style="text-align: center;font-weight: bold;" class="creditCard span8" type="text" placeholder="****-****-****-****">
                                    </div>

                                </div>
                            </div>
                        </div>
                    </fieldset>
                </div>
            </section>
        </div>
    </div>
    <div class="modal-footer">
        <div></div>
        <button type="button" data-dismiss="modal" class="btn btn-yellow btn-mini">Close</button>
        <button type="button" id="save-contact" class="btn btn-yellow btn-mini" onclick="changeStatus(4);">Apply</button>
    </div>
</div>